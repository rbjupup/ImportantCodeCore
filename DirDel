BOOL DelDir(LPCTSTR pszDir)
{
	if(!pszDir)
	{
		return FALSE;
	}

	if(!PathFileExists(pszDir))
	{
		return TRUE;
	}

	BOOL bRet = FALSE;

	TCHAR szSearch[MAX_PATH] = {0};
	_tcscpy_s(szSearch, MAX_PATH, pszDir);
	PathAddBackslash(szSearch);
	PathAppend(szSearch, _T("*.*"));

	TCHAR szTmp[MAX_PATH] = {0};

	WIN32_FIND_DATA data;
	HANDLE hFind = FindFirstFile(szSearch, &data);
	while(hFind != INVALID_HANDLE_VALUE)
	{
		do 
		{
			if(_tcscmp(data.cFileName, _T(".")) == 0 || _tcscmp(data.cFileName, _T("..")) == 0)
			{
				break;
			}

			_tcscpy_s(szTmp, MAX_PATH, pszDir);
			PathAddBackslash(szTmp);
			PathAppend(szTmp, data.cFileName);

			if(data.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)
			{
				bRet = DelDir(szTmp);
			}
			else
			{
				bRet = DeleteFile(szTmp);
			}
		} while (FALSE);

		if(!FindNextFile(hFind, &data))
		{
			break;
		}
	}
	FindClose(hFind);

	bRet = RemoveDirectory(pszDir);
	if(!bRet)
	{
		DWORD dwErrCode = GetLastError();
		return bRet;
	}
	return bRet;
}
